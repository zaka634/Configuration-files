from bs4 import BeautifulSoup
def is_crp(case_number):
    res = requests.get(f"https://www.casestatusext.com/cases/{case_number}")
    soup = BeautifulSoup(res.content, "html.parser")

    crp_section = soup.select("ul.ant-timeline.ant-timeline-label.css-1ij74fp")[0]
    for content in crp_section.contents:
        if "Case Remains Pending" in content.text:
            return True

    return False


def get_case_numbers():
    # res = requests.get("https://www.casestatusext.com/approvals/I-485/MSC-LB")
    # soup = BeautifulSoup(res.content, "html.parser")
    # section = soup.find("script")
    # print(section)
    return [

    ]


def check_crp_status():
    start_time = time.time()
    print(f"start time: {start_time}")
    case_numbers = get_case_numbers()
    crp_list = []
    error_list = []
    for cc_number in case_numbers:
        time.sleep(1)
        print(f"current processing :{cc_number}")
        try:
            if is_crp(cc_number):
                print(f"crp : {cc_number}")
                crp_list.append(cc_number)
        except Exception as e:
            print(f"skip case_number : {cc_number}")
            error_list.append(cc_number)
            continue

    crp_list.sort()

    print(f"{len(crp_list)} case approved: {crp_list}")
    print(f"{len(error_list)} case skipped: {error_list}")
    print(f"end time: {time.time() - start_time}")


check_crp_status()
